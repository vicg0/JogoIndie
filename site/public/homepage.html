<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,300;0,400;0,500;0,700;1,400&display=swap"
      rel="stylesheet"
    />
    <title>Jogos Indie</title>
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/global.css" />
  </head>
  <body>
    <div class="containerBlog entrada" id="mainContainer">
      <header class="">
        <h1>Jogo Indie</h1>
        <div class="navbar">
          <a href="#whatIsGame">O que é jogo indie?</a>
          <a href="">Industria de jogos</a>
          <a href="">Hollow Knight</a>
          <a
            onclick="link('saves.html', 'mainContainer', 'containerBlog fechamentoHomePage')"
            >Sair</a
          >
        </div>
      </header>

      <main>
        <div class="imageBackground area">
          <div class="dirtmounthContent"></div>
        </div>

        <div class="area historyGame">
          <div class="container">
            <div class="historyGameContent">
              <h1>História dos jogos</h1>
              <p>
                Lorem ipsum dolor sit amet consectetur, adipisicing elit.
                Aperiam, officiis esse. Aut ullam sed, sint reiciendis dolorem
                nam voluptatibus quo praesentium ratione quod iste molestiae,
                unde temporibus tempora ducimus? Alias!
              </p>
            </div>
            <img
              src="./assets/bestiary/bestiary__0001_radiant_moth.png"
              alt=""
            />
          </div>
        </div>

        <div class="whatIsGame" id="whatIsGame">
          <div class="container">
            <h2>O que é Jogo Indie?</h2>
            <div class="topics">
              <div class="campoTopics">
                <img src="./assets/team-group-svgrepo-com.svg" alt="" />
                <div class="campoTopicsContent">
                  <h2>Equipe pequena</h2>
                  <p>
                    A produtora possui uma equipe pequena com em média 5
                    integrantes
                  </p>
                </div>
              </div>
              <div class="campoTopics">
                <img src="./assets/money-svgrepo-com.svg" alt="" />
                <div class="campoTopicsContent">
                  <h2>Pouco orçamento</h2>
                  <p>
                    Essas produtoras pouco ou até nenhum orçamento para fazer
                    determinado jogo.
                  </p>
                </div>
              </div>
              <div class="campoTopics">
                <img src="./assets/idea-svgrepo-com.svg" alt="" />
                <div class="campoTopicsContent">
                  <h2>Inovação</h2>
                  <p>
                    Desenvolver jogos inovadores ou fora de caixa para
                    impressionar
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>

      <footer>
        <img src="assets/char_dung_defender_dive.gif" alt="" />

        <div class="container">
          <div id="questionario"></div>
        </div>
      </footer>
    </div>
    <script src="js/route.js"></script>
  </body>
</html>

<script>
  // nome_usuario.innerHTML = sessionStorage.NOME_USUARIO;
  window.scroll({
    top: 0,
    behavior: "smooth",
  });

  var porcentagem = 0;
  var totalHeight = 0;
  function registrarPorcentagem() {
    totalHeight = document.body.scrollHeight - window.innerHeight;
    porcentagem = (window.pageYOffset / totalHeight) * 100;

    porcentagem = porcentagem.toFixed(0);
    fetch("/save/porcentagem", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        idSave: sessionStorage.ID_SAVE,
        fkUsuario: sessionStorage.ID_USUARIO,
        porcentagem: porcentagem,
      }),
    }).then(function (response) {
      response.json(function (json) {
        console.log(json);
      });
    });
  }

  var tiposPerguntas = [];

  fetch("/question/listQuestions", {
    method: "GET",
    headers: {
      "Content-Type": "application/json",
    },
  }).then((response) => {
    response.json().then((json) => {
      console.log(json);

      for (var pergunta = 0; pergunta < json.length; pergunta++) {
        questionario.innerHTML += `
          <div class="campoPergunta">
                <h2>${json[pergunta].doubt}</h2>
                <div id="campoRespostas${
                  pergunta + 1
                }" class="campoRespostas"></div>
                  </div>
                `;

        for (
          var resposta = 0;
          resposta < json[pergunta].resposta.length;
          resposta++
        ) {
          var valorResposta = json[pergunta].resposta[resposta].result;
          var idResposta = json[pergunta].resposta[resposta].idAnswer;
          var grupoResposta = json[pergunta].resposta[resposta].grupoAnswer;
          if (
            tiposPerguntas[pergunta] !=
            json[pergunta].resposta[resposta].grupoAnswer
          ) {
            tiposPerguntas.push(grupoResposta);
          }

          var campoRespostas = document.getElementById(
            `campoRespostas${pergunta + 1}`
          );
          campoRespostas.innerHTML += `
            <div class="resposta">
              <label for="${grupoResposta + idResposta}">
                    <input
                      type="radio"
                      id="${grupoResposta + idResposta}"
                      type="text"
                      name="${grupoResposta}"
                      value="${valorResposta};${json[pergunta].idQuestion}"
                    />
                    ${valorResposta}</label>
                  </div>
            `;
        }
      }

      questionario.innerHTML += `<button onclick="saveQuestionary()" class="buttonQuestionario">Enviar</button>`;
    });
  });

  var respostas = [];
  function saveQuestionary() {
    if (respostas.length < 5) {
      alert("Insira todos os campos");
    } else {
      for (var documento = 0; documento < tiposPerguntas.length; documento++) {
        var documentName = document.getElementsByName(
          tiposPerguntas[documento]
        );

        for (
          var respostaSelecionada = 0;
          respostaSelecionada < documentName.length;
          respostaSelecionada++
        ) {
          if (documentName[respostaSelecionada].checked) {
            var separarValue =
              documentName[respostaSelecionada].value.split(";");
            var value = separarValue[0];
            var fkQuestion = separarValue[1];
            var objectResposta = {
              fkUsuario: sessionStorage.ID_USUARIO,
              respostaQuestion: value,
              fkQuestion: fkQuestion,
            };

            respostas.push(objectResposta);
          }
        }
      }

      fetch("/question/saveQuestionary", {
        method: "post",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          questionary: respostas,
        }),
      }).then((response) => {
        response.json().then((json) => {
          console.log(json);
        });
      });
    }
    console.log(respostas);
  }

  setInterval(function () {
    window.onscroll = function () {
      registrarPorcentagem();
    };
  }, 2000);
</script>
